#!/bin/sh
set -eu

# Enable the keyboard
gsettings set org.gnome.desktop.a11y.applications screen-keyboard-enabled true

# Set the GTK theme
osk_gtk_theme_file="$SNAP_DATA/osk-gtk-theme.txt"
if test -f "$osk_gtk_theme_file"; then
  gsettings set org.gnome.desktop.interface gtk-theme "$(cat "$osk_gtk_theme_file")"
fi

# Set the keyboard layout
osk_layout_file="$SNAP_DATA/osk-layout.txt"
osk_layout_option=""
if [ -e "${osk_layout_file}" ]; then
    osk_layout_option="$(cat "${osk_layout_file}")"
fi
if [ -z "${osk_layout_option}" ]; then
  echo "No keyboard layout specified"
  sources_value="[]"
else
  echo "Using keyboard layout ${osk_layout_option}"
  sources_value="$(printf "[('xkb', '%s')]" "${osk_layout_option}")"
fi
gsettings set org.gnome.desktop.input-sources sources "${sources_value}"

exec "$@"
